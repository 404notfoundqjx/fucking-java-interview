# MySQL

  - [1、数据库的三范式是什么？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#1%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%89%E8%8C%83%E5%BC%8F%E6%98%AF%E4%BB%80%E4%B9%88)
  - [2、一张自增表里面总共有 7 条数据，删除了最后 2 条数据，重启 mysql 数据库，又插入了一条数据，此时 id 是几？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#2%E4%B8%80%E5%BC%A0%E8%87%AA%E5%A2%9E%E8%A1%A8%E9%87%8C%E9%9D%A2%E6%80%BB%E5%85%B1%E6%9C%89-7-%E6%9D%A1%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4%E4%BA%86%E6%9C%80%E5%90%8E-2-%E6%9D%A1%E6%95%B0%E6%8D%AE%E9%87%8D%E5%90%AF-mysql-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%88%E6%8F%92%E5%85%A5%E4%BA%86%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E6%AD%A4%E6%97%B6-id-%E6%98%AF%E5%87%A0)
  - [3、如何获取当前数据库版本？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#3%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC)
  - [4、说一下 ACID 是什么？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#4%E8%AF%B4%E4%B8%80%E4%B8%8B-acid-%E6%98%AF%E4%BB%80%E4%B9%88)
  - [5、char 和 varchar 的区别是什么？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#5char-%E5%92%8C-varchar-%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88)
  - [6、float 和 double 的区别是什么？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#6float-%E5%92%8C-double-%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88)
  - [7、mysql 的内连接、左连接、右连接有什么区别？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#7mysql-%E7%9A%84%E5%86%85%E8%BF%9E%E6%8E%A5%E5%B7%A6%E8%BF%9E%E6%8E%A5%E5%8F%B3%E8%BF%9E%E6%8E%A5%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB)
  - [8、mysql 索引是怎么实现的？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#8mysql-%E7%B4%A2%E5%BC%95%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84)
  - [9、怎么验证 mysql 的索引是否满足需求？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#9%E6%80%8E%E4%B9%88%E9%AA%8C%E8%AF%81-mysql-%E7%9A%84%E7%B4%A2%E5%BC%95%E6%98%AF%E5%90%A6%E6%BB%A1%E8%B6%B3%E9%9C%80%E6%B1%82)
  - [10、说一下数据库的事务隔离？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#10%E8%AF%B4%E4%B8%80%E4%B8%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB)
  - [11、说一下 mysql 常用的引擎？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#11%E8%AF%B4%E4%B8%80%E4%B8%8B-mysql-%E5%B8%B8%E7%94%A8%E7%9A%84%E5%BC%95%E6%93%8E)
  - [12、说一下 mysql 的行锁和表锁？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#12%E8%AF%B4%E4%B8%80%E4%B8%8B-mysql-%E7%9A%84%E8%A1%8C%E9%94%81%E5%92%8C%E8%A1%A8%E9%94%81)
  - [13、说一下乐观锁和悲观锁？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#13%E8%AF%B4%E4%B8%80%E4%B8%8B%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81)
  - [14、mysql 问题排查都有哪些手段？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#14mysql-%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%89%8B%E6%AE%B5)
  - [15、如何做 mysql 的性能优化？](https://github.com/bigrotor187/awesome-java-interview/tree/master/database#15%E5%A6%82%E4%BD%95%E5%81%9A-mysql-%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96)
  
  ## 1、数据库的三范式是什么？

  ## 2、一张自增表里面总共有 7 条数据，删除了最后 2 条数据，重启 mysql 数据库，又插入了一条数据，此时 id 是几？
  - 一般情况下，MySQL 中创建表的类型为 InnoDB，如果新增一条记录（在 MySQL 不重启的情况下），这条记录的 ID 为 8；但是，如果**重启 MySQL 的情况下**，那么这条记录的 ID 为
  6，因为 InnoDB 表只把自增主键的最大 ID 记录到内存中，所以重启数据库或者对表执行 OPTIMIZE 操作，都会使最大 ID 丢失。
  - 如果我们设置表的类型是 MyISAM，那么这条记录的 ID 就是 8。因为MylSAM表会把自增主键的最大ID记录到数据文件里面，重启MYSQL后，自增主键的最大ID也不会丢失。
  - 如果在这 7 条记录里面删除的是中间的几个记录（比如删除的是 3,4,5 三条记录），重启 MySQL 数据库后，insert 一条记录后，ID 都是 8。因为内存或者数据库文件存储的都是自增主键的最大 ID。

  ## 3、如何获取当前数据库版本？

  ## 4、说一下 ACID 是什么？
  - ACID 指的是事务 的四大特性，分别是`原子性（Atomicity）`、`一致性（Consistency）`、`隔离性（Isolation）`、`永久性（Durability）`。
    - **原子性：** 原子性是指事务是一个不可分割的工作单位，事务中的操作要么全部成功，要么全部失败。比如在同一个事务中的SQL语句，要么全部执行成功，要么全部执行失败。
    - **一致性：** 官网上事务一致性的概念是：事务必须使数据库从一个一致性状态变换到另外一个一致性状态。以转账为例子，A向B转账，假设转账之前这两个用户的钱加起来总共是2000，那么A向B转账之后，不管这两个账户怎么转，A用户的钱和B用户的钱加起来的总额还是2000，这个就是事务的一致性。
    - **隔离性：** 事务的隔离性是多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，多个并发事务之间要相互隔离。
    - **永久性：** 持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响。

  ## 5、char 和 varchar 的区别是什么？

  ## 6、float 和 double 的区别是什么？

  ## 7、mysql 的内连接、左连接、右连接有什么区别？

  ## 8、mysql 索引是怎么实现的？

  ## 9、怎么验证 mysql 的索引是否满足需求？

  ## 10、说一下数据库的事务隔离？
  多个线程开启各自事务操作数据库中数据时，数据库系统要负责隔离操作，以保证各个线程在获取数据时的准确性。

**1、事务不考虑隔离性可能会引发的问题**

如果事务不考虑隔离性，可能会引发如下问题：

- （1）脏读
脏读指一个事务读取了另外一个事务未提交的数据。

这是非常危险的，假设Ａ向Ｂ转帐100元，对应sql语句如下所示

```java
1.update account set money=money+100 where name='B';    
2.update account set money=money-100  where name='A';
```
当第1条sql执行完，第2条还没执行(A未提交时)，如果此时Ｂ查询自己的帐户，就会发现自己多了100元钱。如果A等B走后再回滚，B就会损失100元。

- （2）不可重复读
不可重复读指在一个事务内读取表中的某一行数据，多次读取结果不同。

例如银行想查询A帐户余额，第一次查询A帐户为200元，此时A向帐户内存了100元并提交了，银行接着又进行了一次查询，此时A帐户为300元了。银行两次查询不一致，可能就会很困惑，不知道哪次查询是准的。

不可重复读和脏读的区别是，脏读是读取前一事务未提交的脏数据，不可重复读是重新读取了前一事务已提交的数据。

很多人认为这种情况就对了，无须困惑，当然是后面的为准。我们可以考虑这样一种情况，比如银行程序需要将查询结果分别输出到电脑屏幕和写到文件中，结果在一个事务中针对输出的目的地，进行的两次查询不一致，导致文件和屏幕中的结果不一致，银行工作人员就不知道以哪个为准了。

- （3）虚读(幻读)
虚读(幻读)是指在一个事务内读取到了别的事务插入的数据，导致前后读取不一致。

如丙存款100元未提交，这时银行做报表统计account表中所有用户的总额为500元，然后丙提交了，这时银行再统计发现帐户为600元了，造成虚读同样会使银行不知所措，到底以哪个为准。

注：以下为在原文的基础上补充的部分

- （4）丢失修改
丢失修改（Lost to modify）是指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改。 

例如：事务1读取某表中的数据A=20，事务2也读取A=20，事务1修改A=A-1，事务2也修改A=A-1，最终结果A=19，事务1的修改被丢失。

*不可重复读和幻读区别：*

不可重复读的重点是修改，比如多次读取一条记录发现其中某些列的值被修改；幻读的重点在于新增或者删除，比如多次读取一条记录发现记录增多或减少了。

  ## 11、说一下 MySQL 常用的引擎？
  
  MySQL 常用的引擎主要有`InnoDB`和`MyISQM`两种，其中，在 5.5 版本之前，`MyISAM`是 MySQL 默认的数据库引擎，而 5.5 版本之后默认的数据库引擎是`InnoDB`。`MyISAM`强调的是性能，性能极佳，并且提供了大量的特性，比如全文索引、压缩、空间函数等，但是`MyISAM`不支持事务和行级锁，最大的缺陷就是不支持崩溃后的安全恢复。两者的区别主要如下：
  - **是否支持行级锁** : MyISAM 只有表级锁(table-level locking)，而InnoDB 支持行级锁(row-level locking)和表级锁，默认为行级锁；
  - **是否支持外键**： MyISAM不支持，而InnoDB支持；
  - **是否支持事务和崩溃后的安全恢复**：MyISAM 强调的是性能，每次查询具有原子性,其执行速度比 InnoDB 类型更快，但是不提供事务支持。而 InnoDB 提供事务支持，外键等高级数据库功能。 具有事务(commit)、回滚(rollback)和崩溃修复能力(crash recovery capabilities)的事务安全(transaction-safe (ACID compliant))型表。
  - **是否支持MVCC **：仅 InnoDB 支持 MVCC。应对高并发事务，MVCC比单纯的加锁更高效；MVCC只在 READ COMMITTED 和 REPEATABLE READ 两个隔离级别下工作；MVCC可以使用`乐观(optimistic)锁`和`悲观(pessimistic)锁`来实现；各数据库中MVCC实现并不统一。
  
  **那么这两种数据库引擎要如何选择呢？**
  
  - 一般情况下选择 InnoDB 都是没有问题的，但是某些情况下如果并不在乎可扩展能力和并发能力，也不需要事务支持，也不在乎崩溃后的安全恢复问题的话，选择 MyISAM 也是一个不错的选择。但是一般情况下，我们都是需要考虑到这些问题的。

  ## 12、说一下 MySQL 的行级锁和表级锁？
  
  - MyISAM 默认采用的是表级锁（table-level locking），而 InnoDB 支持行级锁（row-level locking）和表级锁，但默认采用的是行级锁。
  - **表级锁：** MySQL 中锁定`粒度最大`的一种锁，对当前操作的整张表加锁，实现简单，资源消耗也比较少，加锁快，不会出现死锁。其锁定粒度最大，触发锁冲突的概率最高，并发度最低，MyISAM和 InnoDB引擎都支持表级锁。
  - **行级锁：** MySQL中锁定`粒度最小`的一种锁，只针对当前操作的行进行加锁。 行级锁能大大减少数据库操作的冲突。其加锁粒度最小，并发度高，但加锁的开销也最大，加锁慢，会出现死锁。
  
  **InnoDB 引擎中锁的算法有三种：**
  - Record lock：单个行记录上的锁
  - Gap lock：间隙锁，锁定一个范围，不包括记录本身
  - Next-key lock：record+gap 锁定一个范围，包含记录本身

  ## 13、说一下乐观锁和悲观锁？

  ## 14、mysql 问题排查都有哪些手段？

  ## 15、如何做 mysql 的性能优化？
